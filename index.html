<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Monitorowanie Węzła Algorand</title>
    <style>
        body {
            background-color: #0d0d0d;
            font-family: monospace;
            color: #c9a6ff;
            text-align: center;
            padding: 30px;
        }
        input {
            padding: 8px;
            font-size: 16px;
            width: 400px;
            border-radius: 5px;
            border: none;
            text-align: center;
            color: #00ff00;
            background-color: #1e1e1e;
        }
        button {
            padding: 8px 15px;
            font-size: 18px;
            border: none;
            border-radius: 5px;
            margin-left: 10px;
            cursor: pointer;
            background-color: #a3d977;
        }
        table {
            width: 80%;
            margin: 20px auto;
            border-collapse: collapse;
            box-shadow: 0 0 20px #9f70ff;
        }
        th, td {
            padding: 10px;
            border: 1px solid #5c4b99;
        }
        th {
            background-color: #1a1a1a;
        }
        .status-online {
            color: #00ff00;
        }
        .status-offline {
            color: red;
        }
    </style>
</head>
<body>
    <h1>Monitorowanie Węzła Algorand</h1>
    <div>
        <input id="address" type="text" placeholder="Wpisz adres portfela" />
        <button onclick="loadData()">Sprawdź</button>
    </div>

    <div id="info">
        <h2>Status węzła: <span id="status" class="status-offline">Nieznany</span></h2>
        <div id="details"></div>
    </div>

    <h2>Kalendarz Otrzymanych Nagród</h2>
    <table id="rewards">
        <thead>
            <tr><th>Data</th><th>Nagroda (ALGO)</th></tr>
        </thead>
        <tbody>
            <tr><td colspan="2">Brak danych</td></tr>
        </tbody>
    </table>

    <script>
        const API_URL = "https://algo-monitor.onrender.com"; // <-- zmień jeśli inny backend

        async function loadData() {
            const address = document.getElementById('address').value;

            try {
                const res = await fetch(`${API_URL}/account-info?address=${address}`);
                const data = await res.json();

                document.getElementById('status').innerText = data.registered_for_rewards ? "Online" : "Offline";
                document.getElementById('status').className = data.registered_for_rewards ? "status-online" : "status-offline";

                document.getElementById('details').innerHTML = `
                    Saldo: ${data.balance.toFixed(6)} ALGO<br/>
                    Pending rewards: ${data.pending_rewards.toFixed(6)} ALGO<br/>
                    Czas od ostatniego bloku: ${data.last_block_time.toFixed(1)} sekund
                `;

            } catch (error) {
                document.getElementById('details').innerText = "Błąd ładowania danych!";
            }

            try {
                const res = await fetch(`${API_URL}/reward-history?address=${address}`);
                const rewardsData = await res.json();

                const tbody = document.querySelector('#rewards tbody');
                tbody.innerHTML = "";

                if (rewardsData.rewards.length === 0) {
                    tbody.innerHTML = "<tr><td colspan='2'>Brak nagród</td></tr>";
                } else {
                    rewardsData.rewards.forEach(reward => {
                        const row = `<tr><td>${reward.date}</td><td>${reward.amount.toFixed(6)}</td></tr>`;
                        tbody.innerHTML += row;
                    });
                }
            } catch (error) {
                document.querySelector('#rewards tbody').innerHTML = "<tr><td colspan='2'>Błąd ładowania danych</td></tr>";
            }
        }
    </script>
</body>
</html>
