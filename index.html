<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Monitorowanie Węzła Algorand</title>
    <style>
        body {
            background-color: #0f0f0f;
            color: #d0a8ff;
            font-family: monospace;
            text-align: center;
        }
        input, button {
            font-family: monospace;
            margin: 5px;
        }
        .online {
            color: limegreen;
        }
        .offline {
            color: red;
        }
        table {
            margin: auto;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid #5c4b99;
        }
        th, td {
            padding: 8px;
        }
    </style>
</head>
<body>

    <h2>Monitorowanie Węzła Algorand</h2>
    <input type="text" id="addressInput" placeholder="Wpisz adres portfela" size="60">
    <button onclick="checkStatus()">Sprawdź</button>

    <h3>Status Węzła</h3>
    <div id="status" class="offline">Offline</div>

    <h3>Średnia Liczba transakcji na blok</h3>
    <div id="averageTx">...</div>

    <h3>Czas od ostatniego bloku</h3>
    <div id="blockTimer">...</div>

    <h3>Kalendarz otrzymanych nagród</h3>
    <table>
        <thead>
            <tr><th>Data nagrody</th></tr>
        </thead>
        <tbody id="rewardCalendar"></tbody>
    </table>

    <script>
        const API_BASE = "https://algo-monitor.onrender.com";

        async function checkStatus() {
            const address = document.getElementById("addressInput").value;

            // Sprawdzenie statusu
            const statusRes = await fetch(`${API_BASE}/node-status?address=${address}`);
            const statusData = await statusRes.json();
            const statusDiv = document.getElementById("status");
            if (statusData.status === "Online") {
                statusDiv.innerText = "Online";
                statusDiv.className = "online";
            } else {
                statusDiv.innerText = "Offline";
                statusDiv.className = "offline";
            }

            // Średnia liczba transakcji na blok
            const txRes = await fetch(`${API_BASE}/average-tx`);
            const txData = await txRes.json();
            document.getElementById("averageTx").innerText = `Średnia transakcji: ${txData.average_tx.toFixed(2)}`;

            // Czas od ostatniego bloku
            const timerRes = await fetch(`${API_BASE}/block-timer`);
            const timerData = await timerRes.json();
            document.getElementById("blockTimer").innerText = `${(timerData.seconds / 1000000).toFixed(1)} sekund od ostatniego bloku`;

            // Kalendarz nagród
            const rewardsRes = await fetch(`${API_BASE}/reward-calendar?address=${address}`);
            const rewardsData = await rewardsRes.json();
            const calendar = document.getElementById("rewardCalendar");
            calendar.innerHTML = "";
            rewardsData.reward_dates.forEach(date => {
                const row = document.createElement("tr");
                const cell = document.createElement("td");
                cell.innerText = date;
                row.appendChild(cell);
                calendar.appendChild(row);
            });
        }
    </script>

</body>
</html>
